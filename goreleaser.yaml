project_name: deepsource
builds:
  - id: "tcv-deepsource"
    main: ./cmd/deepsource_tcv/main.go
    env:
      - CGO_ENABLED=0
    flags:
      - -tags=static_all
    goos:
      - freebsd
      - openbsd
        # TODO: figure out netbsd builds
        # - netbsd
      - linux
      - darwin
    goarch:
      - 386
      - amd64
      - arm64
    ldflags:
      - "-X 'main.version={{ .Version }}' -X 'main.SentryDSN={{ .Env.DEEPSOURCE_CLI_SENTRY_DSN }}'"
  - id: "windows-tcv-deepsource"
    main: ./cmd/deepsource_tcv/main.go
    env:
      - CGO_ENABLED=0
    flags:
      - -tags=static_all
    goos:
      - windows
    goarch:
      - amd64
    ldflags:
      - buildmode=exe
      - "-X 'main.version={{ .Version }}' -X 'main.SentryDSN={{ .Env.DEEPSOURCE_CLI_SENTRY_DSN }}'"
  - id: "deepsource"
    main: ./cmd/deepsource/main.go
    env:
      - CGO_ENABLED=0
    flags:
      - -tags=static_all
    goos:
      - freebsd
      - openbsd
         # TODO: figure out netbsd builds
        # - netbsd
      - linux
      - darwin
    goarch:
      - 386
      - amd64
      - arm64
    ldflags:
      - "-X 'main.version={{ .Version }}' -X 'main.SentryDSN={{ .Env.DEEPSOURCE_CLI_SENTRY_DSN }}'"
  - id: "windows-deepsource"
    main: ./cmd/deepsource/main.go
    env:
      - CGO_ENABLED=0
    flags:
      - -tags=static_all
    goos:
      - windows
    goarch:
      - amd64
    ldflags:
      - buildmode=exe
      - "-X 'main.version={{ .Version }}' -X 'main.SentryDSN={{ .Env.DEEPSOURCE_CLI_SENTRY_DSN }}'"

archives:
  -
    id: "deepsource_tcv"
    builds: ['tcv-deepsource', 'windows-tcv-deepsource']
    name_template: "{{.ProjectName}}_tcv_{{.Version}}_{{.Os}}_{{.Arch}}"
    replacements:
      386: i386
      amd64: x86_64
  -
    id: "deepsource"
    builds: ['deepsource', 'windows-deepsource']
    name_template: "{{.ProjectName}}_{{.Version}}_{{.Os}}_{{.Arch}}"
    replacements:
      386: i386
      amd64: x86_64
checksum:
  name_template: 'checksums.txt'
snapshot:
  name_template: "{{ .Tag }}-next"
changelog:
  sort: asc
  filters:
    exclude:
    - '^tests:'

# brews:
#   - tap:
#       owner: deepsourcelabs
#       name: homebrew-cli
#       branch: cli-release
#       token: "{{ .Env.HOMEBREW_TOKEN }}"
#     commit_author:
#       name: deepsourcebot
#       email: bot@deepsource.io
#     homepage: "https://github.com/deepsourcelabs/cli"
#     description: "Command line interface to DeepSource"
#     license: "BSD 2-Clause Simplified License"
#     skip_upload: auto
